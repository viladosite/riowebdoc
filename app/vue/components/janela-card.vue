<style lang="scss">
  $cor:  #06303c;
  #menumodal {
    position: absolute;
    right: 8%;
    top: 6%;
  }
  svg {
    path {
      fill: $cor;
      opacity: 1;
      transition: opacity .2s;
    }
    &:hover {
      path {
        opacity: .7;
      }
    }
  }
  button {
    &:disabled {
      cursor: default; 
      path {
        fill: gray;
        opacity: .8 !important;
      }
    }
    &:focus {
      outline: none;
    }
    
  }
  .passo {
    h3 {
      margin-top: 0;
      margin-bottom: 40px;
    }
    strong {
      font-family: 'treta';
      font-size: 30px;
      color:  $cor;
    }
    .mdl-textfield--floating-label {
      &.is-focused {
        .mdl-textfield__label {
          color: #d66843;
        }
      }
    }
    .mdl-textfield__input {
      border-bottom: 2px dotted rgba(0,0,0,.12);
    }
    .mdl-textfield__label {
      &:after {
        background-color: #d66843;
      }
    }
  }
</style>

<template>
  <div id="menumodal">
    <button class="steps" @click.prevent="nextStep" v-if="passo < 3 && passo !== 4" :disabled="!ok">
      <svg style="width:40px;height:40px" viewBox="0 0 24 24">
        <path d="m 2.9924138,14.546545 0.01227,-0.04791 -0.01227,0.01227 0,0.03565 z m 0.34396,0.390662 -0.117955,-0.04669 -0.119136,-0.06016 -0.106873,-0.04673 -0.248178,0 0,-0.225981 c 0,-0.307149 -0.02454,-0.982823 -0.07125,-2.025774 -0.04789,-1.028191 0.03074,-1.643851 0.237091,-1.850194 l 0.03562,-0.03561 0.01108,0 0.02453,-0.01093 0.01109,0 0,-0.43872 0.356227,0 c 1.073703,0 2.358793,-0.09444 3.851436,-0.2849739 1.682978,-0.212586 2.9986802,-0.260454 3.9470302,-0.142505 l 0.09593,0.01226 0.07008,0 0.08351,0.01225 0.08219,0 0.07126,0.01108 0.08366,0.0123 0.142467,0.02335 0.08219,0.01225 0.05914,-0.04791 0.07121,-0.05896 0.06017,-0.03565 0.07009,-0.03561 0.07126,-0.04669 0.07121,-0.03565 0.07126,-0.04791 0.07126,-0.03561 0.02335,-0.224809 -0.108941,-0.765393 0.02338,-0.213721 0.02334,-0.105681 0.01227,-0.09581 0.03561,-0.105649 0.165853,0 0.485263,0.07004 0.08351,0.02455 0.07126,0.02335 0.08234,0.01225 c 1.012228,0.30719 2.169002,1.305981 3.2034,1.676966 0.688086,0.2456959 1.707688,0.6166809 3.058998,1.1142409 l 0.367315,0.142468 0.367314,0.130246 0.367314,0.142468 0.367315,0.130397 0.272713,0 0,0.616643 -0.438568,0 -0.0946,0.02338 -0.08351,0.02335 -0.0946,0.02452 -0.0823,0.03565 -0.09581,0.02335 -0.0823,0.03561 -0.03565,0.01226 -0.03561,0.02338 -0.04791,0.01225 -0.03561,0.02335 c -1.027019,0.52946 -2.005263,1.213685 -3.009048,1.79843 -1.178078,0.687932 -2.189545,1.814433 -2.956111,2.37583 l -0.17694,0.130208 -0.167027,0.117947 -0.17694,0.130246 -0.165816,0.131382 -0.165853,0.117947 -0.06017,-0.03561 -0.07126,-0.03561 -0.05896,-0.03565 -0.07126,-0.03561 -0.117948,-0.07126 -0.07126,-0.02334 -0.05899,-0.03565 -0.07126,-0.213873 -0.03561,-0.05884 -0.03561,-0.04669 -0.02338,-0.06032 -0.03561,-0.04654 -0.04791,-0.03565 -0.03561,-0.03561 -0.04669,-0.03561 -0.142506,-0.07126 -0.05899,-0.02335 -0.04787,-0.0123 -0.292845,-0.689107 -0.119272,0 -0.130057,-0.01226 -0.142506,0 -0.130208,-0.01108 -0.07126,-0.01225 -0.07126,0 -0.07009,-0.01225 -0.07121,0 -0.02471,0.02452 c -0.0946,0.0946 -0.525751,0.137625 -1.2911442,0.130246 -1.557594,-0.01595 -3.235729,-0.146194 -5.038018,-0.391852 -0.727223,-0.0946 -1.221067,-0.192909 -1.481513,-0.296061" /> 
      </svg>
    </button>

    <button class="steps" @click.prevent="sendWebcard" v-if="passo === 3" :disabled="!ok"> <i class="modaliconsr material-icons">mail</i> </button>

    <button class="steps" @click.prevent="prevStep" v-if="passo > 0 && passo !== 4"> 
      <svg style="width:40px;height:40px" viewBox="0 0 24 24">
        <path d="m 20.972558,10.570916 -0.01227,0.04791 0.01227,-0.01227 0,-0.03565 z m -0.34396,-0.390662 0.117955,0.04669 0.119136,0.06016 0.106873,0.04673 0.248178,0 0,0.225981 c 0,0.307149 0.02454,0.982823 0.07125,2.025774 0.04789,1.028191 -0.03074,1.643851 -0.237091,1.850194 l -0.03562,0.03561 -0.01108,0 -0.02453,0.01093 -0.01109,0 0,0.43872 -0.356227,0 c -1.073703,0 -2.358793,0.09444 -3.851436,0.284974 -1.682978,0.212586 -2.99868,0.260454 -3.94703,0.142505 l -0.09593,-0.01226 -0.07008,0 -0.08351,-0.01225 -0.08219,0 -0.07126,-0.01108 -0.08366,-0.0123 -0.142467,-0.02335 -0.08219,-0.01225 -0.05914,0.04791 -0.07121,0.05896 -0.06017,0.03565 -0.07009,0.03561 -0.07126,0.04669 -0.07121,0.03565 -0.07126,0.04791 -0.07126,0.03561 -0.02335,0.224809 0.108941,0.765393 -0.02338,0.213721 -0.02334,0.105681 -0.01227,0.09581 -0.03561,0.105649 -0.165853,0 -0.485263,-0.07004 -0.08351,-0.02455 -0.07126,-0.02335 -0.08234,-0.01225 C 9.6515355,16.682705 8.4947615,15.683914 7.4603635,15.312929 6.7722775,15.067233 5.7526755,14.696248 4.4013655,14.198688 l -0.367315,-0.142468 -0.367314,-0.130246 -0.367314,-0.142468 -0.367315,-0.130397 -0.272713,0 0,-0.616643 0.438568,0 0.0946,-0.02338 0.08351,-0.02335 0.0946,-0.02452 0.0823,-0.03565 0.09581,-0.02335 0.0823,-0.03561 0.03565,-0.01226 0.03561,-0.02338 0.04791,-0.01225 0.03561,-0.02335 c 1.027019,-0.52946 2.005263,-1.213685 3.009048,-1.79843 1.178078,-0.687932 2.189545,-1.8144329 2.956111,-2.3758299 l 0.17694,-0.130208 0.1670275,-0.117947 0.17694,-0.130246 0.165816,-0.131382 0.165853,-0.117947 0.06017,0.03561 0.07126,0.03561 0.05896,0.03565 0.07126,0.03561 0.117948,0.07126 0.07126,0.02334 0.05899,0.03565 0.07126,0.213873 0.03561,0.05884 0.03561,0.04669 0.02338,0.06032 0.03561,0.04654 0.04791,0.03565 0.03561,0.03561 0.04669,0.03561 0.142506,0.07126 0.05899,0.02335 0.04787,0.0123 0.292845,0.689107 0.119272,0 0.130057,0.01226 0.142506,0 0.130208,0.01108 0.07126,0.01225 0.07126,0 0.07009,0.01225 0.07121,0 0.02471,-0.02452 c 0.0946,-0.0946 0.525751,-0.137625 1.291144,-0.130246 1.557594,0.01595 3.235729,0.146194 5.038018,0.391852 0.727223,0.0946 1.221067,0.1929089 1.481513,0.2960609" /> 
      </svg>
    </button>
  </div>
  <br>
  <div :is="'passo-' + passo" :webcard.sync="webcard" :naves="naves" :ok.sync="ok" class="passo"></div>
</template>

<script>
  var $$$ = require('jquery')
  var marked = require('marked')
  module.exports = {
    replace: true,
    props: ['webcard', 'janela', 'naves'],
    data: function(){
      return {
        passo: 0,
        ok: false
      }
    },
    watch: {
      webcard: {
        handler: function (val, oldVal) { 
          this.checkPasso()
        },
        deep: true
      }
    },
    methods: {
      nextStep: function() {
        this.passo = this.passo + 1
        this.checkPasso()
      },
      prevStep: function() {
        this.passo = this.passo - 1
        this.ok = true
      },
      sendWebcard: function() {
        this.$dispatch('send-card')
      },
      checkPasso: function() {
        if (this.passo === 0 && this.webcard.nave_videos !== null) {
          this.ok = true
        } else if (this.passo === 1 && this.webcard.videos.length === 3) {
          this.ok = true
        } else if (this.passo === 2 && this.webcard.menssagem !== '') {
          this.ok = true
        } else if (this.passo === 3 && this.webcard.email_criador !== '' && this.webcard.email_enviado !== '') {
          this.ok = true
        } else {
          this.ok = false
        }
      }
    },
    computed: {

    },
    attached: function () {
      componentHandler.upgradeDom()
      this.$on('card-sent', function() {
        this.passo = 4
      })
      this.checkPasso()
    },
    components: {
      'passo-0': require('../components/passo-0.vue'),
      'passo-1': require('../components/passo-1.vue'),
      'passo-2': require('../components/passo-2.vue'),
      'passo-3': require('../components/passo-3.vue'),
      'passo-4': require('../components/passo-4.vue')
    },
    filters: {
      
    }
  }
</script>